# HayekNet Graduate Research Makefile

.PHONY: help activate daily quick run run-analysis analyze setup-automation jupyter paper clean clean-cache clean-runs

help:
	@echo "ğŸ“ HayekNet Graduate Research Commands"
	@echo "======================================="
	@echo ""
	@echo "ğŸ“… Daily Research Workflow:"
	@echo "  daily         - Run full daily research workflow"
	@echo "  quick         - Quick test run (1 hour data)"
	@echo ""
	@echo "ğŸš€ System Execution:"
	@echo "  run           - Run basic simulation"
	@echo "  run-analysis  - Run simulation with full analysis"
	@echo "  analyze       - Generate analysis for latest run"
	@echo ""
	@echo "ğŸ”§ Setup & Tools:"
	@echo "  activate      - Show activation command"
	@echo "  setup-automation - Configure daily 2 AM collection"
	@echo "  jupyter       - Start Jupyter Lab"
	@echo ""
	@echo "ğŸ“ Paper & Documentation:"
	@echo "  paper         - Generate research manuscript (PDF + HTML)"
	@echo ""
	@echo "ğŸ—‘ï¸  Cleanup:"
	@echo "  clean-cache   - Clear old cached data (>7 days)"
	@echo "  clean-runs    - Remove old simulation results"
	@echo "  clean         - Full cleanup (WARNING: removes environment)"

activate:
	@echo ""
	@echo "ğŸ To activate HayekNet environment:"
	@echo "   source activate_hayeknet.sh"
	@echo ""

daily:
	@echo "ğŸ“… Running daily research workflow..."
	@echo ""
	@bash -c "export HAYEKNET_SKIP_CHECKS=1; export PYTHON_JULIACALL_HANDLE_SIGNALS=no; source activate_hayeknet.sh && python scripts/daily_research_workflow.py"
	@echo ""
	@echo "âœ… Daily workflow complete!"
	@echo "ğŸ“– View journal: cat research/journal/journal_$$(date +%Y-%m-%d).md"

quick:
	@echo "âš¡ Running quick test (1 hour data)..."
	@bash -c "export HAYEKNET_SKIP_CHECKS=1; export PYTHON_JULIACALL_HANDLE_SIGNALS=no; source activate_hayeknet.sh && python scripts/daily_research_workflow.py --quick"

run:
	@echo "ğŸš€ Running HayekNet simulation..."
	@bash -c "export PYTHON_JULIACALL_HANDLE_SIGNALS=no; source activate_hayeknet.sh && python -m python.main"

run-analysis:
	@echo "ğŸš€ Running HayekNet with full analysis..."
	@bash -c "export PYTHON_JULIACALL_HANDLE_SIGNALS=no; source activate_hayeknet.sh && python -m python.main_with_analysis"

analyze:
	@echo "ğŸ“Š Generating analysis for latest run..."
	@bash -c "export PYTHON_JULIACALL_HANDLE_SIGNALS=no; source activate_hayeknet.sh && python scripts/analyze_latest.py"

setup-automation:
	@echo "ğŸ”§ Setting up daily 2 AM automation..."
	@bash -c "./scripts/setup_daily_collection.sh"

jupyter:
	@echo "ğŸ“Š Starting Jupyter Lab..."
	@bash -c "export PYTHON_JULIACALL_HANDLE_SIGNALS=no; source activate_hayeknet.sh && jupyter lab --no-browser --port=8888"

paper:
	@echo "ğŸ“ Generating research manuscript..."
	@bash -c "cd docs && quarto render manuscript.qmd --to pdf"
	@bash -c "cd docs && quarto render manuscript.qmd --to html"
	@echo ""
	@echo "âœ… Manuscript generated!"
	@echo "ğŸ“„ PDF: docs/manuscript.pdf"
	@echo "ğŸŒ HTML: docs/manuscript.html"
	@echo ""
	@echo "To view:"
	@echo "  open docs/manuscript.pdf"
	@echo "  open docs/manuscript.html"

clean-cache:
	@echo "ğŸ—‘ï¸  Clearing old cached data (>7 days)..."
	@bash -c "export PYTHON_JULIACALL_HANDLE_SIGNALS=no; source activate_hayeknet.sh && python -c 'from python.data import ERCOTDataClient; ERCOTDataClient().clear_cache(older_than_days=7)'"
	@echo "âœ… Cache cleaned"

clean-runs:
	@echo "ğŸ—‘ï¸  Removing old simulation results..."
	@rm -rf runs/*
	@echo "âœ… Results removed"

clean:
	@echo "âš ï¸  WARNING: This will remove the conda environment!"
	@echo "ğŸ—‘ï¸  Removing conda environment..."
	@conda env remove -n hayeknet -y || true
	@echo "âœ… Environment removed"
